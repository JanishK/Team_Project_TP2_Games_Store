<?php
//if the form has been submitted
if (isset($_POST['submitted'])){
 #prepare the form input

  // connect to the database
  require_once('connectdb.php');
	
  $username=isset($_POST['username'])?$_POST['username']:false;
  $password=isset($_POST['password'])? $_POST['password']:false;
  $password_confirm=isset($_POST['Confirm_password'])?$_POST['Confirm_password']:false;
  $email=isset($_POST['email'])?$_POST['email']:false;
  if (!($username)){
	echo "Username wrong!";
    exit;
	}
  if (!$password || !$password_confirm || !($password == $password_confirm)){
	exit("password wrong!");
	}
	if (!($email)){
		echo "email wrong!";
		exit;
		}
    $password_hash = password_hash($password, PASSWORD_DEFAULT);
 try{
	
	#register user by inserting the user info 
	$stat=$db->prepare("insert into users (username, password, email) VALUES (?, ?, ?)");
	$stat->execute(array($username, $password_hash,$email));
	
	$id=$db->lastInsertId();
	echo "Congratulations! You are now registered. Your ID is: $id  ";  	
	
 }
 catch (PDOException $ex){
	echo "Sorry, a database error occurred! <br>";
	echo "Error details: <em>". $ex->getMessage()."</em>";
 }
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="../CSS/style.css">
    <link rel="icon" type="image/png" href="/Assets/Logo.png">
</head>
<body>
    <div class="nav-bar">
    <ul class="nav-left">
        <img class="page_logo" src="/Assets/Logo.png" alt="">
        <li><a href="./home_Page.html">Home</a></li>
        <li><a href="./Products_Page.html">Products</a></li>
        <li><a href="./aboutUs_Page.html">About</a></li>
    </ul>

    <ul class="nav-right">
        <li><a href="./contact_us.html"><img src="/Assets/Support.svg" class="basket-icon" alt=""></a></li>
        <li><a href="./registration_page.html"><img src="/Assets/Account.svg" class="basket-icon" alt=""></a></li>
        <li><a href="./basket_Page.html">
            <img src="/Assets/Basket.svg" class="basket-icon" />
        </a></li>
    </ul>
</div>

    <div class="register-container">
        <h1>Register Page</h1>
        <p>Please fill in the form below to create an account.</p>
        <div class="registration-form">
            <form method = "post" action="register.php">
	            Email:<input type="email" name="email" /><br>
	            Username: <input type="text" name="username" /><br>
	            Password: <input type="password" name="password" /><br>
                Confirm Password: <input type="password" name="Confirm_password" /><br>
	        <input type="submit" value="Register" /> 
	        <input type="hidden" name="submitted" value="true"/> 
        </div>

  </form>  
  <p> Already a user? <a href="index.php">Log in</a>  </p>
    </div>
</body>
</html>